<!DOCTYPE html>
<html>
<head>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Driver Registration</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="./tailwindCSS.js"></script>

  <script src="../sessions.js"></script>
  <title>Available Deliveries</title>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const driverId = sessionStorage.getItem('user_id');
      
      if(!driverId){
        alert('Driver ID not found. Please log in again')
      }

      fetch(`/api/deliveries/available`)
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById('deliveryList');
          list.innerHTML = '';

          if (!data.length) {
            list.innerHTML = '<p>No delivery jobs available.</p>';
            return;
          }

          data.forEach(delivery => {
            console.log(delivery)
            const card = document.createElement('div');
            card.innerHTML = `
              <h3>Customer: ${delivery.customer_name}</h3>
              <p>Address: ${delivery.address}</p>
              <p>Total: R${delivery.total}</p>
              <p>Delivery ID: ${delivery.id}</p>
              <hr/>
            `;
            const btn = document.createElement('button');
            btn.className = 'btn btn-success';
            btn.textContent = 'Accept Delivery';

            btn.onclick = () => acceptDelivery(delivery.id);


            list.appendChild(card);
            list.appendChild(btn);
          });
        });

    window.acceptDelivery = function(deliveryId) {
  console.log("Clicked delivery ID:", deliveryId); // ðŸ§ª Check this value

  const driverId = sessionStorage.getItem('user_id');
  console.log("Driver id:", driverId)
  if (!driverId) {
    alert("Driver not logged in.");
    return;
  }

  if (!deliveryId) {
    alert("Delivery ID missing!");
    return;
  }

  fetch(`/api/deliveries/accept`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ deliveryId, driverId })
  })
  .then(res => res.json())
  .then(data => {
    alert(data.message);
    location.reload();
  })
  .catch(err => {
    console.error('Error accepting delivery:', err);
  });
}
    }) ;
  </script>
</head>
<body>
  <h1>Available Deliveries</h1>
  <div id="deliveryList">Loading...</div>
</body>
</html>
